<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="businessMapper">

	<!-- Applicants -->
	<resultMap type="Applicants" id="applicantsResultSet">
		<result column="APPLICANTS_NO" property="applicantsNo" />
		<result column="RECRUITMENT_NO" property="recuritmentNo" />
		<result column="POSITION_NO" property="positionNo" />
		<result column="STAGY_NO" property="stagyNo" />
		<result column="RESUME_NO" property="resumeNo" />
		<result column="USER_NAME" property="applicantName" />
		<result column="age" property="age" />
		<result column="USER_GENDER" property="gender" />
		<result column="USER_PIC" property="picture" />
		<result column="career" property="career" />
		<result column="academic_ability" property="academicAbility" />
		<result column="salary" property="salary" />
		<result column="STAGY_NAME" property="stagy" />
		<result column="APPLICANTS_DATE" property="applicantsDate" />
		<result column="RESUME_STATUS" property="resumeStatus" />
		<result column="SCORE" property="score" />
		<result column="MEMO" property="memo" />
		<result column="PASS_STATUS" property="passStatus" />
		<result column="BOOKMARK_STATUS" property="bookmarkStatus" />
	</resultMap>
	
	<!-- ApplicantsStatus -->
	<resultMap type="ApplicantsStatus" id="applicantsStatusResultSet">
		<result column="TOTAL" property="total" />
		<result column="VIEW_COMPLETE" property="viewComplete" />
		<result column="VIEW_NOT_FINISHED" property="viewNotFinished" />
		<result column="EVALUATION_COMPLETE" property="evaluationComplete" />
		<result column="PASS_TOTAL" property="passTotal" />
	</resultMap>
	
	<!-- Position -->
	<resultMap type="Position" id="positionResultSet">
		<result column="POSITION_NO" property="positionNo" />
		<result column="RECRUITMENT_NO" property="recuritmentNo" />
		<result column="POSITION_NAME" property="positionName" />
		<result column="POSITION_RANK" property="positionRank" />
		<result column="EMPLOYMENT_FORM" property="employmentForm" />
		<result column="RECRUITED_PEOPLE" property="recuitedPeople" />
		<result column="VIEW_PEOPLE" property="viewPeople" />
		<result column="EVALUATION_PEOPLE" property="evaluationPeople;" />
		<result column="PASS_PEOPLE" property="passPeople" />
	</resultMap>
	
	<!-- BusinessBookmark -->
	<resultMap type="BusinessBookmark" id="businessBookmarkResultSet">
		<result column="BUSINESS_NO" property="businessNo" />
		<result column="RESUME_NO" property="resumeNo" />
		<result column="APPLICANTS_NAME" property="name" />
		<result column="APPLICANTS_PICTURE" property="picture" />
		<result column="APPLICANTS_PHONE" property="phone" />
		<result column="APPLICANTS_EMAIL" property="email" />
		<result column="RESUME_STATUS" property="resumeStatus" />
		<result column="FOLDER_NAME" property="folder" />
		<result column="APPLICANTS_HISTORY" property="applicantHistory" />
		<result column="APPLICANTS_DATE" property="applicantDate" />
		<result column="ADD_DATE" property="addDate" />
	</resultMap>
	
	
	<!-- 지원자 현황 조회 -->
	<select id="inquireAppsStatus" parameterType="int" resultMap="applicantsStatusResultSet">
		SELECT	COUNT(*) AS TOTAL,
				COUNT(CASE WHEN RESUME_STATUS = 'Y' THEN 1 END) AS VIEW_COMPLETE,
			    COUNT(CASE WHEN RESUME_STATUS = 'N' THEN 1 END) AS VIEW_NOT_FINISHED,
			    COUNT(CASE WHEN SCORE IS NULL THEN 1 END) AS EVALUATION_COMPLETE,
			    COUNT(CASE WHEN PASS_STATUS = 'P' THEN 1 END) AS PASS_TOTAL
		  FROM	APPLICANTS
		 WHERE	RECRUITMENT_NO = #{recruitmentNo}
	</select>
	
	<!-- 포지션 목록 조회 -->
	<select id="inquirePositionList" parameterType="int" resultMap="positionResultSet">
		SELECT	P.POSITION_NO AS POSITION_NO,
				P.RECRUITMENT_NO AS RECRUITMENT_NO,
				POSITION_NAME,
				POSITION_RANK,
				RECRUITED_PEOPLE,
				COUNT(CASE WHEN RESUME_STATUS = 'Y' THEN 1 END) AS VIEW_PEOPLE,
				COUNT(CASE WHEN SCORE IS NULL THEN 1 END) AS EVALUATION_PEOPLE,
				COUNT(CASE WHEN PASS_STATUS = 'P' THEN 1 END) AS PASS_PEOPLE
		  FROM POSITION P
		  JOIN APPLICANTS A ON (P.POSITION_NO = A.POSITION_NO)
		 WHERE A.RECRUITMENT_NO = #{recruitmentNo}
	</select>
	
	<!-- 북마크 목록 조회 -->
	<select id="loadBookmarkList" parameterType="int" resultMap="businessBookmarkResultSet">
		SELECT	BUSINESS_NO,
				RESUME_NO,
				FOLDER_NAME,
				ADD_DATE
		  FROM	BUSINESS_BOOKMARK
		  JOIN	
		 WHERE	BUSINESS_NO = #{businessNo}
	</select>

    <!-- 담당자 정보 저장 -->
    <insert id="insertRepresentativeInfo">
        INSERT INTO JOB_POSTING (RECRUITMENT_NO, REPRESENTATIVE_NAME, REPRESENTATIVE_DEPT, REPRESENTATIVE_EMAIL)
        VALUES (#{recruitmentNo}, #{representativeName}, #{representativeDept}, #{representativeEmail})
    </insert>

    <!-- 홈페이지 주소 저장 -->
    <update id="saveWebsite">
        UPDATE JOB_POSTING
        SET WEBSITE = #{website}
        WHERE RECRUITMENT_NO = #{recruitmentNo}
    </update>

    <!-- 로고 경로 저장 -->
    <update id="saveLogoPath">
        UPDATE JOB_POSTING
        SET LOGO_PATH = #{logoPath}
        WHERE RECRUITMENT_NO = #{recruitmentNo}
    </update>

    <!-- 특정 공고 조회 -->
    <select id="selectJobPostingById" resultType="com.cs.workdream.business.model.vo.JobPosting1">
        SELECT 
            RECRUITMENT_NO, BUSINESS_NO, REPRESENTATIVE_NAME, REPRESENTATIVE_DEPT, REPRESENTATIVE_EMAIL, 
            COMPANY_NAME, WEBSITE, LOGO_PATH
        FROM JOB_POSTING
        WHERE RECRUITMENT_NO = #{recruitmentNo}
    </select>

</mapper>
